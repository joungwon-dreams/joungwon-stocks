---
created: 2025-11-24 19:13:23
updated: 2025-11-24 19:44:58
tags: [feature, pdf, research, holdings, database]
author: wonny
status: active
---

# ë³´ìœ ì¢…ëª© ë¦¬ì„œì¹˜ ë¦¬í¬íŠ¸ PDF ìƒì„±

## ê°œìš”
ê° ë³´ìœ ì¢…ëª©ì— ëŒ€í•œ ìƒì„¸ ë¦¬ì„œì¹˜ ë¦¬í¬íŠ¸ë¥¼ PDF í˜•ì‹ìœ¼ë¡œ ìë™ ìƒì„±í•˜ëŠ” ê¸°ëŠ¥

## êµ¬í˜„ ë‚´ìš©

### ìƒì„±ëœ íŒŒì¼
- `scripts/generate_holding_research_pdf.py`: PDF ìƒì„± ìŠ¤í¬ë¦½íŠ¸

### ì£¼ìš” ê¸°ëŠ¥
1. **ë³´ìœ  í˜„í™© ì„¹ì…˜**
   - ë³´ìœ ìˆ˜ëŸ‰, í‰ê· ë§¤ìˆ˜ê°€, ì´ íˆ¬ìê¸ˆì•¡
   - í˜„ì¬ ì†ìµ ë° ì†ìµë¥ 
   - ì†ìµ ìƒíƒœ í‘œì‹œ (ğŸŸ¢ ìˆ˜ìµ / ğŸ”´ ì†ì‹¤)

2. **ì°¨íŠ¸ ìƒì„±**
   - íˆ¬ì í˜„í™© ë§‰ëŒ€ ì°¨íŠ¸ (í‰ê· ë§¤ìˆ˜ê°€ vs í˜„ì¬ì†ìµ)
   - ì†ìµë¥  íŒŒì´ ì°¨íŠ¸ (íˆ¬ìê¸ˆì•¡ vs ì†ìµ)
   - matplotlib ì‚¬ìš©

3. **í˜„ì¬ ì‹œì„¸ ì •ë³´**
   - ì¢…ëª© ê¸°ë³¸ ì •ë³´ (ì¢…ëª©ëª…, ì½”ë“œ, ì‹œì¥êµ¬ë¶„, ì—…ì¢…)
   - ê°€ê²© ì •ë³´ (í˜„ì¬ê°€, ì „ì¼ëŒ€ë¹„, ì‹œê°€, ê³ ê°€, ì €ê°€, ê±°ë˜ëŸ‰)
   - ë„¤ì´ë²„ ê¸ˆìœµ API ì‚¬ìš©

4. **íˆ¬ì ì˜ê²¬**
   - í˜„ì¬ í¬ì§€ì…˜ ë¶„ì„
   - ì†ìµë¥ ì— ë”°ë¥¸ í–¥í›„ ì „ëµ ì œì•ˆ
   - 4ë‹¨ê³„ êµ¬ë¶„ (ìˆ˜ìµ êµ¬ê°„ / ì†Œí­ ìˆ˜ìµ / ì†Œí­ ì†ì‹¤ / ì†ì‹¤ êµ¬ê°„)

5. **ì°¸ê³  ìë£Œ**
   - ë„¤ì´ë²„ ê¸ˆìœµ ë§í¬
   - KBì¦ê¶Œ HTS ë§í¬
   - ë©´ì±… ì¡°í•­

### ê¸°ìˆ  ìŠ¤íƒ
- **ReportLab**: PDF ìƒì„± ë¼ì´ë¸ŒëŸ¬ë¦¬
- **matplotlib**: ì°¨íŠ¸ ìƒì„±
- **aiohttp**: ë¹„ë™ê¸° HTTP ìš”ì²­
- **í•œê¸€ í°íŠ¸**: NanumGothic TTF

## ì‚¬ìš© ë°©ë²•

### ì‹¤í–‰
```bash
venv/bin/python scripts/generate_holding_research_pdf.py
```

### ì¶œë ¥ ìœ„ì¹˜
```
/Users/wonny/Dev/joungwon.stocks.report/research_report/holding_stock/
â”œâ”€â”€ í•œêµ­ì „ë ¥_015760.pdf
â”œâ”€â”€ ìš°ë¦¬ê¸ˆìœµì§€ì£¼_316140.pdf
â”œâ”€â”€ ì¹´ì¹´ì˜¤_035720.pdf
â”œâ”€â”€ HDCí˜„ëŒ€ì‚°ì—…ê°œë°œ_294870.pdf
â”œâ”€â”€ íŒŒë¼ë‹¤ì´ìŠ¤_034230.pdf
â”œâ”€â”€ í•œêµ­ì¹´ë³¸_017960.pdf
â”œâ”€â”€ HDí˜„ëŒ€ì—ë„ˆì§€ì†”ë£¨ì…˜_329180.pdf
â”œâ”€â”€ ë¡¯ë°ì‡¼í•‘_023530.pdf
â””â”€â”€ ê¸ˆì–‘ê·¸ë¦°íŒŒì›Œ_322310.pdf
```

### ì‹¤í–‰ ê²°ê³¼
```
âœ… PDF ìƒì„± ì™„ë£Œ: 9ê°œ
```

## API ë¬¸ì„œ

### ë°ì´í„° ì¡°íšŒ í•¨ìˆ˜

#### `fetch_stock_info(session, stock_code)`
ì¢…ëª© ê¸°ë³¸ ì •ë³´ ì¡°íšŒ

**íŒŒë¼ë¯¸í„°**:
- `session`: aiohttp ClientSession
- `stock_code`: ì¢…ëª©ì½”ë“œ (6ìë¦¬)

**ë°˜í™˜ê°’**: Dict - ì¢…ëª© ê¸°ë³¸ ì •ë³´
```python
{
    'stockName': 'ì¢…ëª©ëª…',
    'marketValue': 'ì‹œì¥êµ¬ë¶„',
    'industryCodeName': 'ì—…ì¢…',
    ...
}
```

#### `fetch_stock_price_data(session, stock_code)`
ì¢…ëª© ê°€ê²© ë°ì´í„° ì¡°íšŒ

**íŒŒë¼ë¯¸í„°**:
- `session`: aiohttp ClientSession
- `stock_code`: ì¢…ëª©ì½”ë“œ (6ìë¦¬)

**ë°˜í™˜ê°’**: Dict - ê°€ê²© ì •ë³´
```python
{
    'closePrice': í˜„ì¬ê°€,
    'compareToPreviousClosePrice': ì „ì¼ëŒ€ë¹„,
    'fluctuationsRatio': ë“±ë½ë¥ ,
    'openPrice': ì‹œê°€,
    'highPrice': ê³ ê°€,
    'lowPrice': ì €ê°€,
    'accumulatedTradingVolume': ê±°ë˜ëŸ‰,
    ...
}
```

### ì°¨íŠ¸ ìƒì„± í•¨ìˆ˜

#### `create_price_chart(stock_code, stock_name, holding_data, temp_dir)`
ì£¼ê°€ ì°¨íŠ¸ ìƒì„±

**íŒŒë¼ë¯¸í„°**:
- `stock_code`: ì¢…ëª©ì½”ë“œ
- `stock_name`: ì¢…ëª©ëª…
- `holding_data`: ë³´ìœ  í˜„í™© ë°ì´í„°
- `temp_dir`: ì„ì‹œ ë””ë ‰í† ë¦¬ ê²½ë¡œ

**ë°˜í™˜ê°’**: str - ìƒì„±ëœ ì°¨íŠ¸ íŒŒì¼ ê²½ë¡œ

### PDF ìƒì„± í•¨ìˆ˜

#### `generate_pdf_report(stock_code, holding_data, output_dir, temp_dir)`
ê°œë³„ ì¢…ëª© PDF ë¦¬í¬íŠ¸ ìƒì„± (ë¹„ë™ê¸°)

**íŒŒë¼ë¯¸í„°**:
- `stock_code`: ì¢…ëª©ì½”ë“œ
- `holding_data`: ë³´ìœ  í˜„í™© ë°ì´í„°
- `output_dir`: ì¶œë ¥ ë””ë ‰í† ë¦¬
- `temp_dir`: ì„ì‹œ ë””ë ‰í† ë¦¬

**ë°˜í™˜ê°’**: str - ìƒì„±ëœ PDF íŒŒì¼ ê²½ë¡œ

## ë°ì´í„° ì†ŒìŠ¤

### Windows Excel ë°ì´í„°
```python
HOLDINGS = {
    '015760': {'name': 'í•œêµ­ì „ë ¥', 'quantity': 401, 'avg_price': 48200, 'profit': 608435},
    '316140': {'name': 'ìš°ë¦¬ê¸ˆìœµì§€ì£¼', 'quantity': 511, 'avg_price': 25850, 'profit': -140808},
    ...
}
```

### ë„¤ì´ë²„ ê¸ˆìœµ API
- ì¢…ëª© ê¸°ë³¸ ì •ë³´: `https://m.stock.naver.com/api/stock/{stock_code}/basic`
- ê°€ê²© ë°ì´í„°: `https://m.stock.naver.com/api/stock/{stock_code}/price`

## ìŠ¤íƒ€ì¼ë§

### ìƒ‰ìƒ êµ¬ì„±
- **ì œëª©**: `#1a1a1a` (ë‹¤í¬ ê·¸ë ˆì´)
- **ì„¹ì…˜ ì œëª©**: `#2c3e50` (ë„¤ì´ë¹„ ë¸”ë£¨)
- **í…Œì´ë¸” í—¤ë”**: `#34495e`, `#2c3e50`
- **í…Œì´ë¸” ë°°ê²½**: `#ecf0f1`, `#d5dbdb` (ë²ˆê°ˆì•„ ê°€ë©°)
- **ìˆ˜ìµ**: `#27ae60` (ê·¸ë¦°)
- **ì†ì‹¤**: `#e74c3c` (ë ˆë“œ)

### ë ˆì´ì•„ì›ƒ
- **í˜ì´ì§€ í¬ê¸°**: A4
- **ì—¬ë°±**: ìƒë‹¨/í•˜ë‹¨ 2cm, ì¢Œìš° 2cm
- **í°íŠ¸**: NanumGothic (ì¼ë°˜), NanumGothicBold (êµµê²Œ)

## íˆ¬ì ì˜ê²¬ ì „ëµ

### ì†ìµë¥ ì— ë”°ë¥¸ ì „ëµ ì œì•ˆ

| ì†ìµë¥  | ìƒíƒœ | ì „ëµ |
|--------|------|------|
| > 5% | ìˆ˜ìµ êµ¬ê°„ | ëª©í‘œ ìˆ˜ìµë¥  ë‹¬ì„± ì‹œ ì¼ë¶€ ë§¤ë„ ê³ ë ¤, ë¶„í•  ë§¤ë„ ì „ëµ |
| 0% ~ 5% | ì†Œí­ ìˆ˜ìµ | ì¶”ê°€ ìƒìŠ¹ ì—¬ë ¥ ê´€ì°°, ì‹œì¥ íë¦„ í™•ì¸ |
| -3% ~ 0% | ì†Œí­ ì†ì‹¤ | ë‹¨ê¸° ë³€ë™ì„±ìœ¼ë¡œ íŒë‹¨, í€ë”ë©˜í„¸ ì¬í™•ì¸ |
| < -3% | ì†ì‹¤ êµ¬ê°„ | ì†ì ˆ ê¸°ì¤€ ì¬ê²€í† , í¬ì§€ì…˜ ì¶•ì†Œ ê³ ë ¤ |

## ì£¼ì˜ì‚¬í•­

### í•œê¸€ í°íŠ¸
- NanumGothic TTF í°íŠ¸ ì‚¬ìš© (í”„ë¡œì íŠ¸ ë‚´ë¶€ `fonts/` í´ë”)
- í°íŠ¸ íŒŒì¼ì´ ì—†ëŠ” ê²½ìš° Helveticaë¡œ ëŒ€ì²´ (í•œê¸€ ê¹¨ì§ ê°€ëŠ¥)
- í°íŠ¸ ìœ„ì¹˜:
  - `fonts/NanumGothic.ttf` (Regular, 2.0MB)
  - `fonts/NanumGothicBold.ttf` (Bold, 2.0MB)

### API í˜¸ì¶œ ì œí•œ
- API í˜¸ì¶œ ê°„ 0.5ì´ˆ ëŒ€ê¸° (rate limit ë°©ì§€)
- ì´ 9ê°œ ì¢…ëª© Ã— 2ê°œ API = 18ë²ˆ í˜¸ì¶œ

### ë°ì´í„° íƒ€ì„ìŠ¤íƒ¬í”„
- ëª¨ë“  ì„¹ì…˜ì— ë°ì´í„° ì¶œì²˜ì™€ ìˆ˜ì§‘ ì‹œê°„ í‘œì‹œ
- í˜•ì‹: `YYYY-MM-DD HH:MM:SS`

## í™•ì¥ ê°€ëŠ¥ì„±

### ì¶”ê°€ ê¸°ëŠ¥ ì•„ì´ë””ì–´
- [ ] ê³¼ê±° 3ê°œì›” ì°¨íŠ¸ ì¶”ê°€ (ì¼ë´‰ ë°ì´í„°)
- [ ] ê¸°ìˆ ì  ì§€í‘œ ì¶”ê°€ (ì´ë™í‰ê· ì„ , RSI ë“±)
- [ ] ë‰´ìŠ¤ ìš”ì•½ ì¶”ê°€
- [ ] ì¬ë¬´ì œí‘œ ìš”ì•½ ì¶”ê°€
- [ ] ë™ì¢…ì—…ê³„ ë¹„êµ ë¶„ì„
- [ ] ìë™ ì´ë©”ì¼ ë°œì†¡ ê¸°ëŠ¥

## ë°ì´í„°ë² ì´ìŠ¤ ê¸°ë°˜ ë²„ì „ (v2)

### ê°œìš”
v2ì—ì„œëŠ” í•˜ë“œì½”ë”©ëœ ë°ì´í„° ëŒ€ì‹  ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ì—¬ ë¦¬í¬íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

### ìƒì„±ëœ íŒŒì¼
- `scripts/generate_research_from_db.py`: ë°ì´í„°ë² ì´ìŠ¤ ê¸°ë°˜ PDF ìƒì„± ìŠ¤í¬ë¦½íŠ¸

### ì£¼ìš” ê°œì„ ì‚¬í•­
1. **ì‹¤ì‹œê°„ ë°ì´í„° ì¡°íšŒ**
   - stock_assets í…Œì´ë¸”ì—ì„œ ë³´ìœ  í˜„í™© ì¡°íšŒ
   - collected_data í…Œì´ë¸”ì—ì„œ ìˆ˜ì§‘ëœ ë°ì´í„° íƒ€ì… ì¡°íšŒ
   - ë„¤ì´ë²„ ê¸ˆìœµ APIì—ì„œ ìµœì‹  ì‹œì„¸ ì¡°íšŒ

2. **ìë™í™”ëœ ë°ì´í„° ìˆ˜ì§‘ ì›Œí¬í”Œë¡œìš°**
   ```bash
   # 1. Excel ë°ì´í„°ë¥¼ stock_assetsì— ì €ì¥
   venv/bin/python scripts/import_windows_excel_holdings.py

   # 2. 41ê°œ ì‚¬ì´íŠ¸ì—ì„œ ë°ì´í„° ìˆ˜ì§‘
   venv/bin/python scripts/collect_holding_stocks_data.py

   # 3. collected_dataì˜ ìµœì‹  ê°€ê²©ìœ¼ë¡œ stock_assets ì—…ë°ì´íŠ¸
   venv/bin/python scripts/update_current_prices.py

   # 4. ë°ì´í„°ë² ì´ìŠ¤ ê¸°ë°˜ ë¦¬í¬íŠ¸ ìƒì„±
   venv/bin/python scripts/generate_research_from_db.py
   ```

3. **ìë™ ì¢…ëª© ê°ì§€**
   - stock_assets í…Œì´ë¸”ì—ì„œ `quantity > 0`ì¸ ì¢…ëª©ë§Œ ìë™ ì„ íƒ
   - ë³´ìœ ì¢…ëª©ì´ ë³€ê²½ë˜ë©´ ìë™ìœ¼ë¡œ ë¦¬í¬íŠ¸ ëŒ€ìƒ ë³€ê²½

4. **ë°ì´í„° íƒ€ì… ì¶”ì **
   - ê° ì¢…ëª©ë³„ë¡œ ìˆ˜ì§‘ëœ ë°ì´í„° íƒ€ì… í‘œì‹œ
   - Site IDì™€ Domain IDë¡œ ë°ì´í„° ì¶œì²˜ ì¶”ì 
   - ìˆ˜ì§‘ ì‹œê°„ íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë¡

### ë°ì´í„° ì†ŒìŠ¤
1. **stock_assets í…Œì´ë¸”**
   ```sql
   SELECT stock_code, stock_name, quantity, avg_buy_price, current_price
   FROM stock_assets
   WHERE is_active = TRUE AND quantity > 0
   ```

2. **collected_data í…Œì´ë¸”**
   ```sql
   SELECT DISTINCT ON (data_type)
       data_type, site_id, domain_id, collected_at
   FROM collected_data
   WHERE ticker = $1
   ORDER BY data_type, collected_at DESC
   ```

3. **ë„¤ì´ë²„ ê¸ˆìœµ API**
   - Basic Info: `https://m.stock.naver.com/api/stock/{code}/basic`
   - Price Data: `https://m.stock.naver.com/api/stock/{code}/price`

### ì‹¤í–‰ ê²°ê³¼ (2025-11-24 19:44)
```
âœ… ì „ì²´ ë¦¬í¬íŠ¸ ìƒì„± ì™„ë£Œ: 10ê°œ
- í•œí™” (000880): -9.08%
- í•œêµ­ì „ë ¥ (015760): +3.55%
- í•œêµ­ì¹´ë³¸ (017960): -2.01%
- ë¡¯ë°ì‡¼í•‘ (023530): -0.17%
- íŒŒë¼ë‹¤ì´ìŠ¤ (034230): -0.80%
- ì¹´ì¹´ì˜¤ (035720): +2.53%
- HDCí˜„ëŒ€ì‚°ì—…ê°œë°œ (294870): +6.73%
- ìš°ë¦¬ê¸ˆìœµì§€ì£¼ (316140): -0.97%
- ê¸ˆì–‘ê·¸ë¦°íŒŒì›Œ (322310): -0.32%
- HDí˜„ëŒ€ì—ë„ˆì§€ì†”ë£¨ì…˜ (329180): -1.78%
```

### ê¸°ìˆ ì  ê°œì„ ì‚¬í•­
1. **ì•ˆì „í•œ íƒ€ì… ë³€í™˜**
   ```python
   def safe_int(value, default=0):
       """ë„¤ì´ë²„ APIê°€ ë¬¸ìì—´ ë°˜í™˜í•  ë•Œ ëŒ€ì‘"""
       try:
           return int(float(value))
       except (ValueError, TypeError):
           return default
   ```

2. **API ì‘ë‹µ ì²˜ë¦¬**
   ```python
   # List ì‘ë‹µ ì²˜ë¦¬
   if isinstance(data, list) and len(data) > 0:
       return data[0]
   ```

3. **ê²½ê³  ë©”ì‹œì§€ ì–µì œ**
   ```python
   import warnings
   warnings.filterwarnings('ignore', category=UserWarning, module='matplotlib')
   ```

## ê´€ë ¨ ë¬¸ì„œ
- ê±°ë˜ PDF: [[features/trading-report-pdf]]
- ë°ì´í„° ìˆ˜ì§‘: [[features/data-collection-system]]
- Troubleshooting: [[troubleshooting/pdf-generation-errors]]
- ë³€ê²½ ì´ë ¥: [[changelog/2025-11-24-changes]]
